engine.project.compile()
"<!doctype html><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Race-3D.htm</title><style>body{background:#000;color:#aaa;font-family:sans-serif}canvas{left:0;position:absolute;top:0}.hidden{display:none}</style><script>var engine={project:{compile:(function (args){
"use strict";


        args = args || {};

        args['reset'] = args['reset'] || {};

        for(var todo in args['reset']){

            eval(args['reset'][todo]);

        }



        var compiledCode = engine.toSource();



        compiledCode = compiledCode.substring(0, compiledCode.length - 1);

        compiledCode = compiledCode.replace('(', 'var engine=');



        compiledCode = '<!doctype html><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>'

          + engine.project.title

          + '</title><style>body{background:#000;color:#aaa;font-family:sans-serif}canvas{left:0;position:absolute;top:0}.hidden{display:none}</style><script>'

          + compiledCode + ';'

          + 'window.onload=engine.init;<' + '/script>';



        return String(compiledCode);

    }), export:(function (args){
"use strict";


        args = args || {};

        args['properties'] = args['properties'] || {};



        var exported = {};



        for(var property in args['properties']){

            exported[args['properties'][property]] = eval(args['properties'][property]);

        }



        return JSON.stringify(exported);

    }), import:(function (args){
"use strict";


        args = args || {};

        args['confirm'] = args['confirm'] !== void 0

          ? args['confirm']

          : true;

        args['project'] = args['project'] || {};



        if(!args['confirm']

          || window.confirm('Import project?')){

            for(var property in args['project']){

                eval(property + ' = ' + args['project'][property]);

            }

        }

    }), set:{title:(function (args){
"use strict";


          document.title = args['title'];

          engine.project.title = args['title'];

      })}, title:"Race-3D.htm"}, test:(function (args){
"use strict";


      args['log'] = args['log'] || '';

      var result = args['todo']();

      var successful = true;



      if(args['expected'].constructor == Array

        || args['expected'].constructor == Object){

          for(var key in args['expected']){

              if(result[key] !== args['expected'][key]){

                  successful = false;

                  break;

              }

          }



      }else if(result !== args['expected']){

          successful = false;

      }



      if(args['log'].length > 0){

          console.log(

            '%c\n'

              + args['log']

              + ' = '

              + successful,

            successful

              ? ''

              : 'color: #f00'

          );

      }



      return Boolean(successful);

  }), variables:{'_default.png':"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAD1BMVEUAAP8A/wD/AAAAAAD///8hKtLYAAAAIklEQVQoz2NwQQMMTkoQIAgBIiNMwIEBAowhwGSECaAnBwAdPj4tFnzwQgAAAABJRU5ErkJggg==", '_fff.png':"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAFElEQVQIW2P8////fwYGBgZGGAMAV9UH+8NxzmcAAAAASUVORK5CYII=", _perspective:{height:4, value:{0:1.6300716400146484, 1:0, 2:0, 3:0, 4:0, 5:3.260143280029297, 6:0, 7:0, 8:0, 9:0, 10:-1, 11:-1, 12:0, 13:0, 14:-2, 15:0}, width:4}, _camera:{height:4, value:{0:1, 1:0, 2:0, 3:0, 4:0, 5:1, 6:0, 7:0, 8:0, 9:0, 10:1, 11:0, 12:0, 13:0, 14:0, 15:1}, width:4}}, version:"20160221.2", canvas:{clear:(function (args){
"use strict";


      args = args || {};

      args['target'] = args['target'] || 'canvas';



      engine.canvas.canvases[args['target']].clearRect(

        0,

        0,

        engine.canvas.width,

        engine.canvas.height

      );

  }), draw:{circle:(function (args){
"use strict";


        args['target'] = args['target'] || args['circle']['target'] || 'canvas';

        var texture = args['circle']['texture'] || false;



        var fillstyle = texture !== false

          ? engine.canvas.canvases[args['target']].createPattern(

              texture,

              'repeat'

            )

          : args['circle']['color'];



        engine.canvas.canvases[args['target']].beginPath();

            engine.canvas.canvases[args['target']].arc(

              args['circle']['x'],

              args['circle']['y'],

              args['circle']['radius'],

              0,

              engine.math.tau,

              false

            );

        engine.canvas.canvases[args['target']].closePath();



        engine.canvas.canvases[args['target']].fillStyle = fillstyle;

        engine.canvas.canvases[args['target']].strokeStyle = args['circle']['color'];

        engine.canvas.canvases[args['target']][

          !engine.canvas.wireframe && args['circle']['fill']

            ? 'fill'

            : 'stroke'

        ]();

    }), entities:(function (args){
"use strict";


        args = args || {};

        args['targetOverride'] = args['targetOverride'] || void 0;



        for(var entity in engine.object.entities){

            var target = args['targetOverride'] || engine.object.entities[entity]['target'];



            engine.canvas.canvases[target].save();



            engine.canvas.canvases[target].translate(

              engine.object.entities[entity]['position']['x'],

              engine.object.entities[entity]['position']['y']

            );



            engine.canvas.canvases[target].scale(

              engine.object.entities[entity]['scale']['x'],

              engine.object.entities[entity]['scale']['y']

            );



            engine.canvas.canvases[target].rotate(

              engine.math.degreesToRadians({

                'degrees': engine.object.entities[entity]['rotate']['y'],

              })

            );



            var entityObject = {

              'target': target,

            };

            var type = engine.object.entities[entity]['type'];

            entityObject[type] = engine.object.entities[entity];

            engine.canvas.draw[type](entityObject);



            engine.canvas.canvases[target].restore();

        }

    }), fade:(function (args){
"use strict";


        args = args || {};

        args['target'] = args['target'] || 'canvas';



        var alphaCache = engine.canvas.canvases[args['target']].globalAlpha;



        engine.canvas.canvases[args['target']].globalAlpha = engine.canvas.fade['alpha'];

        engine.canvas.canvases[args['target']].fillStyle = engine.canvas.fade['color'];

        engine.canvas.canvases[args['target']].fillRect(

          0,

          0,

          engine.canvas.width,

          engine.canvas.height

        );



        engine.canvas.canvases[args['target']].globalAlpha = alphaCache;

    }), fromBuffer:(function (args){
"use strict";


        args = args || {};

        args['target'] = args['target'] || 'canvas';



        engine.canvas.canvases[args['target']].drawImage(

          document.getElementById('buffer'),

          0,

          0

        );

    }), polygon:(function (args){
"use strict";


        args['target'] = args['target'] || args['polygon']['target'] || 'canvas';

        var texture = args['polygon']['texture'] || false;



        var fillstyle = texture !== false

          ? engine.canvas.canvases[args['target']].createPattern(

              texture,

              'repeat'

            )

          : args['polygon']['color'];



        engine.canvas.canvases[args['target']].beginPath();

            var verticesLength = args['polygon']['vertices'].length;

            if(verticesLength === 1){

                engine.canvas.canvases[args['target']].rect(

                  args['polygon']['vertices'][0][0],

                  args['polygon']['vertices'][0][1],

                  1,

                  1

                );



            }else{

                engine.canvas.canvases[args['target']].moveTo(

                  args['polygon']['vertices'][0][0],

                  args['polygon']['vertices'][0][1]

                );

                for(var loopCounter = 1; loopCounter < verticesLength; loopCounter++){

                    engine.canvas.canvases[args['target']].lineTo(

                      args['polygon']['vertices'][loopCounter][0],

                      args['polygon']['vertices'][loopCounter][1]

                    );

                }

            }

        engine.canvas.canvases[args['target']].closePath();



        engine.canvas.canvases[args['target']].fillStyle = fillstyle;

        engine.canvas.canvases[args['target']].strokeStyle = args['polygon']['color'];

        engine.canvas.canvases[args['target']][

          !engine.canvas.wireframe && args['polygon']['fill']

            ? 'fill'

            : 'stroke'

        ]();

    }), text:(function (args){
"use strict";


        args['target'] = args['target'] || args['text']['target'] || 'canvas';



        engine.canvas.canvases[args['target']].direction = args['text']['direction'] || 'inherit';

        engine.canvas.canvases[args['target']].fillStyle = args['text']['color'] || '#fff';

        engine.canvas.canvases[args['target']].font = args['text']['font'] || '10px sans-serif';

        engine.canvas.canvases[args['target']].textAlign = args['text']['align'] || 'start';

        engine.canvas.canvases[args['target']].textBaseline = args['text']['baseline'] || 'alphabetic';



        engine.canvas.canvases[args['target']].fillText(

          args['text']['text'],

          args['text']['position']['x'],

          args['text']['position']['y']

        );

    })}, init:(function (args){
"use strict";


      args = args || {};

      args['buffer'] = args['buffer'] || 'buffer';

      args['canvas'] = args['canvas'] || 'canvas';

      args['options'] = args['options'] || {

        'alpha': false,

      };



      engine.canvas.canvases['buffer'] =

        document.getElementById(args['buffer']).getContext('2d', args['options']);

      engine.canvas.canvases['canvas'] =

        document.getElementById(args['canvas']).getContext('2d', args['options']);



      engine.canvas.resize();

      window.onresize = engine.canvas.resize;

  }), resize:(function (){
"use strict";


      engine.canvas.height = window.innerHeight;

      document.getElementById('buffer').height = engine.canvas.height;

      document.getElementById('canvas').height = engine.canvas.height;



      engine.canvas.width = window.innerWidth;

      document.getElementById('buffer').width = engine.canvas.width;

      document.getElementById('canvas').width = engine.canvas.width;

  }), screenshot:(function (args){
"use strict";


      args = args || {};

      args['format'] = args['format'] || 'image/png';

      args['quality'] = args['quality'] || 1;

      args['target'] = args['target'] || 'canvas';



      return document.getElementById(args['target']).toDataURL(

        args['format'],

        args['quality']

      );

  }), set:{linearGradient:(function (args){
"use strict";


        args['target'] = args['target'] || 'canvas';



        var gradient = engine.canvas.canvases[args['target']].createLinearGradient(

          args['x0'],

          args['y0'],

          args['x1'],

          args['y1']

        );



        for(var stop in args['colorStops']){

            gradient.addColorStop(

              stop,

              args['colorStops'][stop]

            );

        }



        engine.variables[args['key']] = gradient;

    }), radialGradient:(function (args){
"use strict";


        args['target'] = args['target'] || 'canvas';



        var gradient = engine.canvas.canvases[args['target']].createRadialGradient(

          args['x0'],

          args['y0'],

          args['r0'],

          args['x1'],

          args['y1'],

          args['r1']

        );



        for(var stop in args['colorStops']){

            gradient.addColorStop(

              stop,

              args['colorStops'][stop]

            );

        }



        engine.variables[args['key']] = gradient;

    })}, canvases:{buffer:{viewportHeight:419, viewportWidth:1366}, canvas:{}}, fade:{alpha:0, color:"#fff"}, height:419, width:1366, wireframe:false}, html:{execute:(function (args){
"use strict";


      for(var id in args['ids']){

          eval(

            engine.html.target({

              'attibuteLength': args['attribute'].length,

              'id': args['ids'][id],

            })

          )();

      }

  }), get:{attribute:(function (args){
"use strict";


        return eval(

          engine.html.target({

            'attributeLength': args['attribute'].length,

            'id': args['id'],

          })

        );

    }), exists:(function (args){
"use strict";


        return Boolean(document.getElementById(args['id']) !== void 0);

    }), fullscreen:(function (args){
"use strict";


        args = args || {};

        args['id'] = args['id'] || false;



        if(args['id'] !== false){

            return Boolean(

              document.getElementById(args['id'])

              && document.fullscreenElement === document.getElementById(args['id'])

            );

        }



        return document.fullscreenElement;

    })}, set:{attribute:(function (args){
"use strict";


        for(var id in args['ids']){

            target = engine.html.target({

              'attributeLength': args['attribute'].length,

              'id': args['ids'][id],

            });

            target += ' = args[\'newValue\'];';



            eval(target);

        }

    }), cssClass:(function (args){
"use strict";


        args['action'] = args['action'] || 'add';



        document.getElementById(args['id']).classList[args['action']](args['class']);

    }), element:(function (args){
"use strict";


        args['attributes'] = args['attributes'] || '';

        args['classes'] = args['classes'] || [];

        args['newValues'] = args['newValues'] || '';

        if(args['parent'] === void 0){

            args['parent'] = 'body';

        }

        args['parent'] = document.getElementById(args['parent'])

          || document.getElementsByTagName(args['parent'])[0];



        var newElement = document.createElement(args['type']);

        newElement.id = args['id'];



        args['parent'].appendChild(newElement);



        for(var cssClass in args['classes']){

            engine.html.set.cssClass({

              'class': args['classes'][cssClass],

              'id': args['id'],

            });

        }



        for(var attribute in args['attributes']){

            engine.html.set.attribute({

              'attribute': args['attributes'][attribute],

              'ids': args['id'],

              'newValue': args['newValues'][attribute],

            });

        }

    }), fullscreen:(function (args){
"use strict";


        document.getElementById(args['id'])[

          args['state']

            ? 'requestFullscreen'

            : 'exitFullscreen'

        ]();

    }), image:(function (args){
"use strict";


        args = args || {};

        args['src'] = args['src'] || engine.variables['_default.png'];

        args['todo'] = args['todo'] || false;



        var image = new Image();

        image.src = args['src'];



        if(args['todo'] !== false){

            image.onload = args['todo'];

        }



        return image;

    })}, target:(function (args){
"use strict";


      var target = 'document.getElementById("' + args['id'] + '")[args[\'attribute\'][0]]';



      var loopCounter = 1;

      while(loopCounter < args['attributeLength']){

          target += '[args[\'attribute\'][' + loopCounter + ']]'

          loopCounter++;

      }



      return String(target);

  })}, keyboard:{get:{loop:(function (args){
"use strict";


        return Boolean(

          engine.keyboard.keyBinds[args['key']] !== void 0

          && engine.keyboard.keyBinds[args['key']][args['event']] !== void 0

          && engine.keyboard.keyBinds[args['key']][args['event']]['loop']

        );

    }), keyCode:(function (event){
"use strict";


        return Number(

          event.keyCode

          || event.which

        );

    })}, handle:{functions:(function (args){
"use strict";


        if(engine.keyboard.keyBinds[args['key']] !== void 0

          && engine.keyboard.keyBinds[args['key']][args['event']] !== void 0){

            engine.keyboard.keyBinds[args['key']][args['event']]();

        }

    }), onkeydown:(function (event){
"use strict";


        var key = engine.keyboard.get.keyCode(event);



        engine.keyboard.keyStates[key] = true;



        if(!engine.keyboard.get.loop({'event': 'keydown', 'key': key,})){

            engine.keyboard.handle.functions({

              'event': 'keydown',

              'key': key,

            });

        }

    }), onkeypress:(function (event){
"use strict";


        var key = engine.keyboard.get.keyCode(event);



        if(!engine.keyboard.get.loop({'event': 'keypress', 'key': key,})){

            engine.keyboard.handle.functions({

              'event': 'keypress',

              'key': key,

            });

        }

    }), onkeyup:(function (event){
"use strict";


        var key = engine.keyboard.get.keyCode(event);



        delete engine.keyboard.keyStates[key];



        if(!engine.keyboard.get.loop({'event': 'keyup', 'key': key,})){

            engine.keyboard.handle.functions({

              'event': 'keyup',

              'key': key,

            });

        }

    })}, init:(function (){
"use strict";


      window.onkeydown = engine.keyboard.handle.onkeydown;

      window.onkeypress = engine.keyboard.handle.onkeypress;

      window.onkeyup = engine.keyboard.handle.onkeyup;

  }), repeatEvents:(function (){
"use strict";


      for(var event in engine.keyboard.events){

          if(engine.keyboard.events[event] !== true){

              continue;

          }



          for(var key in engine.keyboard.keyBinds){

              if(engine.keyboard.keyBinds[key][event] !== void 0

                && engine.keyboard.keyStates[key] !== void 0){

                  engine.keyboard.keyBinds[key][event]();

              }

          }

      }

  }), set:{keyBind:(function (args){
"use strict";


        if(typeof args['key'] === 'string'){

            var temp = args['key'];

            args['key'] = temp.charCodeAt(0);

        }



        if(engine.keyboard.keyBinds[args['key']] === void 0){

            engine.keyboard.keyBinds[args['key']] = {};

        }



        engine.keyboard.keyBinds[args['key']][args['event']] = args['todo'];

        engine.keyboard.keyBinds[args['key']][args['event']]['loop'] = args['loop'];

        engine.keyboard.events[args['event']] = args['loop'];

    })}, events:{keydown:true}, keyBinds:{32:{keydown:(function (){
"use strict";


          engine.camera.move({

            'dy': .1,

            'speed': 0,

          });

      })}, 65:{keydown:(function (){
"use strict";


          engine.camera.move({

            'dy': 0,

            'speed': -.1,

            'strafe': true,

          });

      })}, 67:{keydown:(function (){
"use strict";


          engine.camera.move({

            'dy': -.1,

            'speed': 0,

          });

      })}, 68:{keydown:(function (){
"use strict";


          engine.camera.move({

            'dy': 0,

            'speed': .1,

            'strafe': true,

          });

      })}, 83:{keydown:(function (){
"use strict";


          engine.camera.move({

            'dy': 0,

            'speed': -.1,

          });

      })}, 87:{keydown:(function (){
"use strict";


          engine.camera.move({

            'dy': 0,

            'speed': .1,

          });

      })}}, keyStates:{}}, math:{average:(function (args){
"use strict";


      var result = 0;

      for(var number in args['numbers']){

          result += args['numbers'][number];

      }

      result /= args['numbers'].length;



      return Number(result);

  }), catalan:(function (args){
"use strict";


      if(args['integer'] <= 1){

          return 1;

      }



      var result = Math.floor(

        engine.math.factorial({'integer': args['integer'] * 2})

          / engine.math.factorial({'integer': args['integer'] + 1})

          / engine.math.factorial({'integer': args['integer']})

          + .5

      );



      return Number(result);

  }), clamp:(function (args){
"use strict";


      var difference = args['maximum'] - args['minimum'];

      args['wrap'] = args['wrap'] || false;



      if(args['wrap']){

          while(args['value'] < args['minimum']){

              args['value'] += difference;

          }

          while(args['value'] >= args['maximum']){

              args['value'] -= difference;

          }



      }else{

          args['value'] = Math.max(

            args['minimum'],

            args['value']

          );

          args['value'] = Math.min(

            args['maximum'],

            args['value']

          );

      }



      return Number(args['value']);

  }), collision:{circle:(function (args){
"use strict";


        var point0 = {};

        var point1 = {};

        for(var axis in args['axes0']){

            point0[axis] = args['axes0'][axis];

            point1[axis] = args['axes1'][axis];

        }



        var distance = engine.math.distance({

          'point0': point0,

          'point1': point1,

        });



        return Boolean(distance < args['radius0'] + args['radius1']);

    }), rectangle:(function (args){
"use strict";


        var boolean = true;



        for(var axis in args['rectangle0']['position']){

            boolean = !(args['rectangle0']['position'][axis]

              + args['rectangle0']['size'][axis]

              <= args['rectangle1']['position'][axis]);

            if(boolean === false){

                break;

            }



            boolean = !(args['rectangle1']['position'][axis]

              + args['rectangle1']['size'][axis]

              <= args['rectangle0']['position'][axis]);

            if(boolean === false){

                break;

            }

        }



        return Boolean(boolean);

    })}, convertBase:(function (args){
"use strict";


      return String(Number.parseInt(args['value'], args['oldbase']).toString(args['newbase']));

  }), degreesToRadians:(function (args){
"use strict";


      args['decimals'] = args['decimals'] !== void 0

        ? args['decimals']

        : engine.math.decimals;



      return engine.math.round({

        'decimals': args['decimals'],

        'value': Number(args['degrees'] * engine.math.degree),

      });

  }), distance:(function (args){
"use strict";


      args['decimals'] = args['decimals'] !== void 0

        ? args['decimals']

        : engine.math.decimals;



      var result = 0;



      for(var axis in args['point0']){

          result += Math.pow(

            args['point1'][axis] - args['point0'][axis],

            2

          );

      }



      return engine.math.round({

        'decimals': args['decimals'],

        'value': Number(Math.sqrt(result)),

      });

  }), factorial:(function (args){
"use strict";


      var result = 1;



      for(var loopCounter = 2; loopCounter <= args['integer']; loopCounter++){

          result *= loopCounter;

      }



      return Number(result);

  }), fibonacci:(function (args){
"use strict";


      if(args['integer'] === 0){

          return 0;

      }



      var negative = false;

      if(args['integer'] < 0

        && args['integer'] % 2 === 0){

          negative = true;

      }

      args['integer'] = Math.abs(args['integer']);



      var values = [0, 1];

      var valuesCache = 0;



      var loopCounter = 0;

      while(loopCounter < args['integer'] - 1){

          valuesCache = values[1];

          values[1] = values[1] + values[0];

          values[0] = valuesCache;

          loopCounter++;

      }



      if(negative){

          values[1] *= -1;

      }



      return Number(values[1]);

  }), matrix:{add:(function (args){
"use strict";


        if(!engine.math.matrix.compare({

            'from': args['from'],

            'matrix': args['matrix'],

          })){

            return false;

        }



        if(args['multiplier'] === void 0){

            args['multiplier'] = 1;

        }



        for(var key in args['from']['value']){

            args['matrix']['value'][key] += args['from']['value'][key] * args['multiplier'];

        }

    }), camera:(function (args){
"use strict";


        var matrix = engine.math.matrix.create({

          'length': 16,

        });

        var ratio = args['width'] / args['height'];



        engine.math.matrix.setValues({

          'matrix': matrix,

          'value': 0,

        });



        matrix['value'][0] = ratio / 2;

        matrix['value'][5] = ratio;

        matrix['value'][10] = -1;

        matrix['value'][11] = -1;

        matrix['value'][14] = -2;



        engine.math.matrix.round({

          'matrix': matrix,

        });



        return matrix;

    }), compare:(function (args){
"use strict";


        args['swapped'] = args['swapped'] || false;



        var from_first = 'height';

        var from_last = 'width';



        if(args['swapped']){

            from_first = 'width';

            from_last = 'height';

        }



        return Boolean(

          args['matrix']['height'] === args['from'][from_first]

            && args['matrix']['width'] === args['from'][from_last]

        );

    }), clone:(function (args){
"use strict";


        var newMatrix = engine.math.matrix.create({

          'length': args['matrix']['value'].length,

        });



        engine.math.matrix.copy({

          'from': args['matrix'],

          'matrix': newMatrix,

        });



        return newMatrix;

    }), copy:(function (args){
"use strict";


        if(!engine.math.matrix.compare({

            'from': args['from'],

            'matrix': args['matrix'],

          })){

            return false;

        }



        for(var key in args['from']['value']){

            args['matrix']['value'][key] = args['from']['value'][key];

        }

    }), create:(function (args){
"use strict";


        return {

          'height': Math.sqrt(args['length']),

          'value': new Float32Array(args['length']),

          'width': Math.sqrt(args['length']),

        };

    }), getValue:(function (args){
"use strict";


        args['x'] = args['x'] || 0;

        args['y'] = args['y'] || 0;



        if(args['x'] < args['matrix']['width']

          && args['y'] < args['matrix']['height']){

            return Number(

              args['matrix']['value'][

                args['y'] * args['matrix']['height']

                  + args['x']

              ]

            );

        }

    }), identity:(function (args){
"use strict";


        for(var key in args['matrix']['value']){

            if(key % (args['matrix']['width'] + 1) === 0){

                args['matrix']['value'][key] = 1;

            }

        }

    }), multiply:(function (args){
"use strict";


        if(!engine.math.matrix.compare({

            'from': args['from'],

            'matrix': args['matrix'],

            'swapped': true,

          })){

            return false;

        }



        var matrixCache = engine.math.matrix.clone({

          'matrix': args['matrix'],

        });



        /* 2x2 matrix. */

        if(args['matrix']['width'] === 2){

            args['matrix']['value'][0] =

              args['from']['value'][0] * matrixCache['value'][0]

              + args['from']['value'][1] * matrixCache['value'][2];

            args['matrix']['value'][1] =

              args['from']['value'][0] * matrixCache['value'][1]

              + args['from']['value'][1] * matrixCache['value'][3];



            args['matrix']['value'][2] =

              args['from']['value'][2] * matrixCache['value'][0]

              + args['from']['value'][3] * matrixCache['value'][2];

            args['matrix']['value'][3] =

              args['from']['value'][2] * matrixCache['value'][1]

              + args['from']['value'][3] * matrixCache['value'][3];



        /* 3x3 matrix. */

        }else if (args['matrix']['width'] === 3){

            args['matrix']['value'][0] =

              args['from']['value'][0] * matrixCache['value'][0]

              + args['from']['value'][1] * matrixCache['value'][3]

              + args['from']['value'][2] * matrixCache['value'][6];

            args['matrix']['value'][1] =

              args['from']['value'][0] * matrixCache['value'][1]

              + args['from']['value'][1] * matrixCache['value'][4]

              + args['from']['value'][2] * matrixCache['value'][7];

            args['matrix']['value'][2] =

              args['from']['value'][0] * matrixCache['value'][2]

              + args['from']['value'][1] * matrixCache['value'][5]

              + args['from']['value'][2] * matrixCache['value'][8];



            args['matrix']['value'][3] =

              args['from']['value'][3] * matrixCache['value'][0]

              + args['from']['value'][4] * matrixCache['value'][3]

              + args['from']['value'][5] * matrixCache['value'][6];

            args['matrix']['value'][4] =

              args['from']['value'][3] * matrixCache['value'][1]

              + args['from']['value'][4] * matrixCache['value'][4]

              + args['from']['value'][5] * matrixCache['value'][7];

            args['matrix']['value'][5] =

              args['from']['value'][3] * matrixCache['value'][2]

              + args['from']['value'][4] * matrixCache['value'][5]

              + args['from']['value'][5] * matrixCache['value'][8];



            args['matrix']['value'][6] =

              args['from']['value'][6] * matrixCache['value'][0]

              + args['from']['value'][7] * matrixCache['value'][3]

              + args['from']['value'][8] * matrixCache['value'][6];

            args['matrix']['value'][7] =

              args['from']['value'][6] * matrixCache['value'][1]

              + args['from']['value'][7] * matrixCache['value'][4]

              + args['from']['value'][8] * matrixCache['value'][7];

            args['matrix']['value'][8] =

              args['from']['value'][6] * matrixCache['value'][2]

              + args['from']['value'][7] * matrixCache['value'][5]

              + args['from']['value'][8] * matrixCache['value'][8];



        /* 4x4 matrix. */

        }else if (args['matrix']['width'] === 4){

            args['matrix']['value'][0] =

              args['from']['value'][0] * matrixCache['value'][0]

              + args['from']['value'][1] * matrixCache['value'][4]

              + args['from']['value'][2] * matrixCache['value'][8]

              + args['from']['value'][3] * matrixCache['value'][12];

            args['matrix']['value'][1] =

              args['from']['value'][0] * matrixCache['value'][1]

              + args['from']['value'][1] * matrixCache['value'][5]

              + args['from']['value'][2] * matrixCache['value'][9]

              + args['from']['value'][3] * matrixCache['value'][13];

            args['matrix']['value'][2] =

              args['from']['value'][0] * matrixCache['value'][2]

              + args['from']['value'][1] * matrixCache['value'][6]

              + args['from']['value'][2] * matrixCache['value'][10]

              + args['from']['value'][3] * matrixCache['value'][14];

            args['matrix']['value'][3] =

              args['from']['value'][0] * matrixCache['value'][3]

              + args['from']['value'][1] * matrixCache['value'][7]

              + args['from']['value'][2] * matrixCache['value'][11]

              + args['from']['value'][3] * matrixCache['value'][15];



            args['matrix']['value'][4] =

              args['from']['value'][4] * matrixCache['value'][0]

              + args['from']['value'][5] * matrixCache['value'][4]

              + args['from']['value'][6] * matrixCache['value'][8]

              + args['from']['value'][7] * matrixCache['value'][12];

            args['matrix']['value'][5] =

              args['from']['value'][4] * matrixCache['value'][1]

              + args['from']['value'][5] * matrixCache['value'][5]

              + args['from']['value'][6] * matrixCache['value'][9]

              + args['from']['value'][7] * matrixCache['value'][13];

            args['matrix']['value'][6] =

              args['from']['value'][4] * matrixCache['value'][2]

              + args['from']['value'][5] * matrixCache['value'][6]

              + args['from']['value'][6] * matrixCache['value'][10]

              + args['from']['value'][7] * matrixCache['value'][14];

            args['matrix']['value'][7] =

              args['from']['value'][4] * matrixCache['value'][3]

              + args['from']['value'][5] * matrixCache['value'][7]

              + args['from']['value'][6] * matrixCache['value'][11]

              + args['from']['value'][7] * matrixCache['value'][15];



            args['matrix']['value'][8] =

              args['from']['value'][8] * matrixCache['value'][0]

              + args['from']['value'][9] * matrixCache['value'][4]

              + args['from']['value'][10] * matrixCache['value'][8]

              + args['from']['value'][11] * matrixCache['value'][12];

            args['matrix']['value'][9] =

              args['from']['value'][8] * matrixCache['value'][1]

              + args['from']['value'][9] * matrixCache['value'][5]

              + args['from']['value'][10] * matrixCache['value'][9]

              + args['from']['value'][11] * matrixCache['value'][13];

            args['matrix']['value'][10] =

              args['from']['value'][8] * matrixCache['value'][2]

              + args['from']['value'][9] * matrixCache['value'][6]

              + args['from']['value'][10] * matrixCache['value'][10]

              + args['from']['value'][11] * matrixCache['value'][14];

            args['matrix']['value'][11] =

              args['from']['value'][8] * matrixCache['value'][3]

              + args['from']['value'][9] * matrixCache['value'][7]

              + args['from']['value'][10] * matrixCache['value'][11]

              + args['from']['value'][11] * matrixCache['value'][15];



            args['matrix']['value'][12] =

              args['from']['value'][12] * matrixCache['value'][0]

              + args['from']['value'][13] * matrixCache['value'][4]

              + args['from']['value'][14] * matrixCache['value'][8]

              + args['from']['value'][15] * matrixCache['value'][12];

            args['matrix']['value'][13] =

              args['from']['value'][12] * matrixCache['value'][1]

              + args['from']['value'][13] * matrixCache['value'][5]

              + args['from']['value'][14] * matrixCache['value'][9]

              + args['from']['value'][15] * matrixCache['value'][13];

            args['matrix']['value'][14] =

              args['from']['value'][12] * matrixCache['value'][2]

              + args['from']['value'][13] * matrixCache['value'][6]

              + args['from']['value'][14] * matrixCache['value'][10]

              + args['from']['value'][15] * matrixCache['value'][14];

            args['matrix']['value'][15] =

              args['from']['value'][12] * matrixCache['value'][3]

              + args['from']['value'][13] * matrixCache['value'][7]

              + args['from']['value'][14] * matrixCache['value'][11]

              + args['from']['value'][15] * matrixCache['value'][15];

        }



        engine.math.matrix.round({

          'matrix': args['matrix'],

        });

    }), rotate:(function (args){
"use strict";


        /* Rotate X axis. */

        var matrixCache = engine.math.matrix.clone({

          'matrix': args['matrix'],

        });

        var cosine = Math.cos(args['dimensions'][0]);

        var sine = Math.sin(args['dimensions'][0]);



        args['matrix']['value'][4] = matrixCache['value'][4] * cosine + matrixCache['value'][8] * sine;

        args['matrix']['value'][5] = matrixCache['value'][5] * cosine + matrixCache['value'][9] * sine;

        args['matrix']['value'][6] = matrixCache['value'][6] * cosine + matrixCache['value'][10] * sine;

        args['matrix']['value'][7] = matrixCache['value'][7] * cosine + matrixCache['value'][11] * sine;

        args['matrix']['value'][8] = matrixCache['value'][8] * cosine - matrixCache['value'][4] * sine;

        args['matrix']['value'][9] = matrixCache['value'][9] * cosine - matrixCache['value'][5] * sine;

        args['matrix']['value'][10] = matrixCache['value'][10] * cosine - matrixCache['value'][6] * sine;

        args['matrix']['value'][11] = matrixCache['value'][11] * cosine - matrixCache['value'][7] * sine;



        /* Rotate Y axis. */

        engine.math.matrix.copy({

          'from': args['matrix'],

          'matrix': matrixCache,

        });

        cosine = Math.cos(args['dimensions'][1]);

        sine = Math.sin(args['dimensions'][1]);



        args['matrix']['value'][0] = matrixCache['value'][0] * cosine - matrixCache['value'][8] * sine;

        args['matrix']['value'][1] = matrixCache['value'][1] * cosine - matrixCache['value'][9] * sine;

        args['matrix']['value'][2] = matrixCache['value'][2] * cosine - matrixCache['value'][10] * sine;

        args['matrix']['value'][3] = matrixCache['value'][3] * cosine - matrixCache['value'][11] * sine;

        args['matrix']['value'][8] = matrixCache['value'][8] * cosine + matrixCache['value'][0] * sine;

        args['matrix']['value'][9] = matrixCache['value'][9] * cosine + matrixCache['value'][1] * sine;

        args['matrix']['value'][10] = matrixCache['value'][10] * cosine + matrixCache['value'][2] * sine;

        args['matrix']['value'][11] = matrixCache['value'][11] * cosine + matrixCache['value'][3] * sine;



        /* Rotate Z axis. */

        engine.math.matrix.copy({

          'from': args['matrix'],

          'matrix': matrixCache,

        });

        cosine = Math.cos(args['dimensions'][2]);

        sine = Math.sin(args['dimensions'][2]);



        args['matrix']['value'][0] = matrixCache['value'][0] * cosine + matrixCache['value'][4] * sine;

        args['matrix']['value'][1] = matrixCache['value'][1] * cosine + matrixCache['value'][5] * sine;

        args['matrix']['value'][2] = matrixCache['value'][2] * cosine + matrixCache['value'][6] * sine;

        args['matrix']['value'][3] = matrixCache['value'][3] * cosine + matrixCache['value'][7] * sine;

        args['matrix']['value'][4] = matrixCache['value'][4] * cosine - matrixCache['value'][0] * sine;

        args['matrix']['value'][5] = matrixCache['value'][5] * cosine - matrixCache['value'][1] * sine;

        args['matrix']['value'][6] = matrixCache['value'][6] * cosine - matrixCache['value'][2] * sine;

        args['matrix']['value'][7] = matrixCache['value'][7] * cosine - matrixCache['value'][3] * sine;

    }), round:(function (args){
"use strict";


        args['decimals'] = args['decimals'] !== void 0

          ? args['decimals']

          : engine.math.decimals;



        for(var key in args['matrix']['value']){

            args['matrix']['value'][key] = engine.math.round({

              'decimals': args['decimals'],

              'value': args['matrix']['value'][key],

            });

        }

    }), scale:(function (args){
"use strict";


        for(var dimension in args['dimensions']){

            var loopCounter = 0;

            var offset = dimension * args['matrix']['width'];

            while(loopCounter < args['matrix']['width']){

                args['matrix']['value'][loopCounter + offset] *= args['dimensions'][dimension];

                loopCounter++;

            }

        }



        engine.math.matrix.round({

          'matrix': args['matrix'],

        });

    }), setValues:(function (args){
"use strict";


        for(var key in args['matrix']['value']){

            args['matrix']['value'][key] = args['value'];

        }

    }), translate:(function (args){
"use strict";


        args['matrix']['value'][12] -= args['matrix']['value'][0] * args['dimensions'][0]

          + args['matrix']['value'][4] * args['dimensions'][1]

          + args['matrix']['value'][8] * args['dimensions'][2];

        args['matrix']['value'][13] -= args['matrix']['value'][1] * args['dimensions'][0]

          + args['matrix']['value'][5] * args['dimensions'][1]

          + args['matrix']['value'][9] * args['dimensions'][2];

        args['matrix']['value'][14] -= args['matrix']['value'][2] * args['dimensions'][0]

          + args['matrix']['value'][6] * args['dimensions'][1]

          + args['matrix']['value'][10] * args['dimensions'][2];

        args['matrix']['value'][15] -= args['matrix']['value'][3] * args['dimensions'][0]

          + args['matrix']['value'][7] * args['dimensions'][1]

          + args['matrix']['value'][11] * args['dimensions'][2];



        engine.math.matrix.round({

          'matrix': args['matrix'],

        });

    }), transpose:(function (args){
"use strict";


        var matrixCache = engine.math.matrix.clone({

          'matrix': args['matrix'],

        });



        /* 2x2 matrix. */

        if(args['matrix']['width'] === 2){

            /* args['matrix']['value'][0] = matrixCache['value'][0]; */

            args['matrix']['value'][1] = matrixCache['value'][2];

            args['matrix']['value'][2] = matrixCache['value'][1];

            /* args['matrix']['value'][3] = matrixCache['value'][3]; */



        /* 3x3 matrix. */

        }else if (args['matrix']['width'] === 3){

            /* args['matrix']['value'][0] = matrixCache['value'][0]; */

            args['matrix']['value'][1] = matrixCache['value'][3];

            args['matrix']['value'][2] = matrixCache['value'][6];

            args['matrix']['value'][3] = matrixCache['value'][1];

            /* args['matrix']['value'][4] = matrixCache['value'][4]; */

            args['matrix']['value'][5] = matrixCache['value'][7];

            args['matrix']['value'][6] = matrixCache['value'][2];

            args['matrix']['value'][7] = matrixCache['value'][5];

            /* args['matrix']['value'][8] = matrixCache['value'][8]; */



        /* 4x4 matrix. */

        }else if (args['matrix']['width'] === 4){

            /* args['matrix']['value'][0] = matrixCache['value'][0]; */

            args['matrix']['value'][1] = matrixCache['value'][4];

            args['matrix']['value'][2] = matrixCache['value'][8];

            args['matrix']['value'][3] = matrixCache['value'][12];

            args['matrix']['value'][4] = matrixCache['value'][1];

            /* args['matrix']['value'][5] = matrixCache['value'][5]; */

            args['matrix']['value'][6] = matrixCache['value'][9];

            args['matrix']['value'][7] = matrixCache['value'][13];

            args['matrix']['value'][8] = matrixCache['value'][2];

            args['matrix']['value'][9] = matrixCache['value'][6];

            /* args['matrix']['value'][10] = matrixCache['value'][10]; */

            args['matrix']['value'][11] = matrixCache['value'][14];

            args['matrix']['value'][12] = matrixCache['value'][3];

            args['matrix']['value'][13] = matrixCache['value'][7];

            args['matrix']['value'][14] = matrixCache['value'][11];

            /* args['matrix']['value'][15] = matrixCache['value'][15]; */

        }

    })}, mersenne:(function (args){
"use strict";


      return Number(Math.pow(2, args['value']) - 1);

  }), radiansToDegrees:(function (args){
"use strict";


      args['decimals'] = args['decimals'] !== void 0

        ? args['decimals']

        : engine.math.decimals;



      return engine.math.round({

        'decimals': args['decimals'],

        'value': Number(args['radians'] * engine.math.radian),

      });

  }), round:(function (args){
"use strict";


      args['decimals'] = args['decimals'] !== void 0

        ? args['decimals']

        : engine.math.decimals;

      args['type'] = args['type'] || 'round';



      if(String(args['value']).indexOf('e') >= 0){

          args['value'] = Number(args['value'].toFixed(args['decimals']));

      }



      return Number(

        Math[args['type']](args['value'] + 'e+' + args['decimals'])

          + 'e-' + args['decimals']

      );

  }), volume:{cone:(function (args){
"use strict";


        args['decimals'] = args['decimals'] !== void 0

          ? args['decimals']

          : engine.math.decimals;

        args['radius1'] = args['radius1'] || args['radius0'];



        return engine.math.round({

          'decimals': args['decimals'],

          'value': Number(

            (Math.PI * args['height']) / 3

              * (

                Math.pow(args['radius0'], 2)

                + args['radius0'] * args['radius1']

                + Math.pow(args['radius1'], 2)

              )

          ),

        });

    }), rectangle:(function (args){
"use strict";


        args['decimals'] = args['decimals'] !== void 0

          ? args['decimals']

          : engine.math.decimals;



        var result = 0;



        for(var axis in args['axes']){

            if(result === 0){

                result = args['axes'][axis];



            }else{

                result *= args['axes'][axis];

            }

        }



        return engine.math.round({

          'decimals': args['decimals'],

          'value': Number(result),

        });

    })}, decimals:7, degree:0.017453292519943295, radian:57.29577951308232, tau:6.283185307179586}, camera:{move:(function (args){
"use strict";


      args = args || {};

      args['axis'] = args['axis'] || 'y';

      args['dy'] = args['dy'] !== void 0

        ? args['dy']

        : false;

      args['speed'] = args['speed'] !== void 0

        ? args['speed']

        : 1;

      args['strafe'] = args['strafe'] || false;

      var radians = engine.math.degreesToRadians({

        'degrees': engine.camera.rotation[args['axis']] + (args['strafe'] ? 90 : 0),

      });



      engine.camera.position['x'] += args['speed'] * Math.sin(radians);

      if(args['dy'] !== false){

          engine.camera.position['y'] += args['dy'];

          engine.camera.position['z'] += args['speed'] * Math.cos(radians);



      }else{

          engine.camera.position['y'] += args['speed'] * Math.cos(radians);

      }

  }), reset:(function (){
"use strict";


      for(var position in engine.camera.position){

          engine.camera.position[position] = 0;

      }

      for(var rotation in engine.camera.rotation){

          engine.camera.rotation[rotation] = 0;

      }

  }), rotate:(function (args){
"use strict";


      for(var dimension in args['dimensions']){

          engine.camera.rotation[dimension] = engine.math.clamp({

            'maximum': 360,

            'minimum': 0,

            'value': engine.camera.rotation[dimension] + args['dimensions'][dimension],

            'wrap': true,

          });

      }

  }), set:{dimensions:(function (args){
"use strict";


        engine.camera.position = {};

        engine.camera.rotation = {};



        for(var dimension in args['dimensions']){

            engine.camera.position[dimension] = 0;

            engine.camera.rotation[dimension] = 0;

        }

    }), position:(function (dimensions){
"use strict";


        for(var dimension in args['dimensions']){

            engine.camera.position[dimension] = args['dimensions'][dimension];

        }

    }), rotation:(function (dimensions){
"use strict";


        for(var dimension in args['dimensions']){

            engine.camera.rotation[dimension] = engine.math.clamp({

              'maximum': 360,

              'minimum': 0,

              'value': args['dimensions'][dimension],

              'wrap': true,

            });

        }

    })}, translate:(function (args){
"use strict";


      for(var dimension in args['dimensions']){

          engine.camera.position[dimension] += args['dimensions'][dimension];

      }

  }), position:{x:0, y:0, z:0}, rotation:{x:0, y:0, z:0}}, mouse:{get:{loop:(function (args){
"use strict";


        return Boolean(

          engine.mouse.buttonBinds[args['button']] !== void 0

          && engine.mouse.buttonBinds[args['button']][args['event']] !== void 0

          && engine.mouse.buttonBinds[args['button']][args['event']]['loop']

        );

    }), movement:(function (args){
"use strict";


        return Number(

          args['event']['movement' + args['dimension']]

          || 0

        );

    }), mouseDown:(function (args){
"use strict";


        args = args || {};

        args['specificButton'] = args['specificButton'] || false;

        var result = false;



        if(args['specificButton'] !== false){

            result = engine.mouse.buttonId > -1;



        }else{

            result = engine.mouse.buttonId == args['specificButton'];

        }



        return Boolean(result);

    }), pointerLock:(function (args){
"use strict";


        args = args || {};

        args['id'] = args['id'] || false;



        if(args['id'] !== false){

            return Boolean(

              document.getElementById(args['id'])

              && document.pointerLockElement === document.getElementById(args['id'])

            );

        }



        return document.pointerLockElement;

    }), wheelDelta:(function (event){
"use strict";


        return Number(

          event.wheelDelta

          || -event.detail

        );

    })}, handle:{functions:(function (args){
"use strict";


        args['cache'] = args['cache'] || false;



        if(engine.mouse.buttonBinds[args['button']] !== void 0

          && engine.mouse.buttonBinds[args['button']][args['event']] !== void 0){

            if(engine.mouse.buttonBinds[args['button']][args['event']]['cache']){

                engine.mouse.buttonBinds[args['button']][args['event']](args['cache']);



            }else{

                engine.mouse.buttonBinds[args['button']][args['event']]();

            }



        }else if(args['button'] !== 'any'){

            engine.mouse.handle.functions({

              'button': 'any',

              'cache': args['cache'],

              'event': args['event'],

            });

        }

    }), oncontextmenu:(function (event){
"use strict";


        if(!engine.mouse.oncontextmenu){

            return false;

        }

    }), ondoubleclick:(function (event){
"use strict";


    }), onmousedown:(function (event){
"use strict";


        engine.mouse.buttonId = event.button;

        for(var dimension in engine.mouse.click){

            engine.mouse.click[dimension] = event['page' + dimension.toUpperCase()];

        }



        if(!engine.mouse.get.loop({'button': engine.mouse.buttonId, 'event': 'mousedown',})){

            engine.mouse.handle.functions({

              'button': engine.mouse.buttonId,

              'event': 'mousedown',

            });

        }

    }), onmouseenter:(function (event){
"use strict";


    }), onmouseleave:(function (event){
"use strict";


    }), onmousemove:(function (event){
"use strict";


        for(var dimension in engine.mouse.position){

            var dimensionUpperCase = dimension.toUpperCase();

            engine.mouse.movement[dimension] = engine.mouse.get.movement({

              'dimension': dimensionUpperCase,

              'event': event,

            });

            engine.mouse.position[dimension] = event['page' + dimensionUpperCase];

        }



        if(engine.mouse.get.mouseDown()){

            for(var dimension in engine.mouse.drag){

                engine.mouse.drag[dimension] = event['page' + dimension.toUpperCase()] - engine.mouse.click[dimension];

            }

        }



        if(!engine.mouse.get.loop({'button': engine.mouse.buttonId, 'event': 'mousemove',})){

            engine.mouse.handle.functions({

              'button': engine.mouse.buttonId,

              'event': 'mousemove',

            });

        }

    }), onmouseout:(function (event){
"use strict";


    }), onmouseover:(function (event){
"use strict";


    }), onmouseup:(function (event){
"use strict";


        engine.mouse.buttonId = -1;

        for(var dimension in engine.mouse.drag){

            engine.mouse.drag[dimension] = 0;

        }



        if(!engine.mouse.get.loop({'button': engine.mouse.buttonId, 'event': 'mouseup',})){

            engine.mouse.handle.functions({

              'button': engine.mouse.buttonId,

              'event': 'mouseup',

            });

        }

    }), onmousewheel:(function (event){
"use strict";


        engine.mouse.wheelDelta = engine.mouse.get.wheelDelta(event);

    }), onpointerlockchange:(function (event){
"use strict";


        engine.mouse.pointerLock = engine.mouse.get.pointerLock({

          'id': 'canvas',

        });

    }), ontouchcancel:(function (event){
"use strict";


        engine.mouse.handle.onmouseup(event);

    }), ontouchend:(function (event){
"use strict";


        engine.mouse.handle.onmouseup(event);

    }), ontouchenter:(function (event){
"use strict";


        engine.mouse.handle.onmouseenter(event);

    }), ontouchleave:(function (event){
"use strict";


        engine.mouse.handle.onmouseleave(event);

    }), ontouchmove:(function (event){
"use strict";


        engine.mouse.handle.onmousemove(event);

    }), ontouchstart:(function (event){
"use strict";


        engine.mouse.handle.onmousedown(event);

    })}, init:(function (){
"use strict";


      if('onmousewheel' in window){

          window.onmousewheel = engine.mouse.handle.onmousewheel;



      }else{

          document.addEventListener(

            'DOMMouseScroll',

            engine.mouse.handle.onmousewheel,

            false

          );

      }



      document.onpointerlockchange = engine.mouse.handle.onpointerlockchange;

      window.oncontextmenu = engine.mouse.handle.oncontextmenu;

      window.ondblclick = engine.mouse.handle.ondoubleclick;

      window.onmousedown = engine.mouse.handle.onmousedown;

      window.onmouseenter = engine.mouse.handle.onmouseenter;

      window.onmouseleave = engine.mouse.handle.onmouseleave;

      window.onmousemove = engine.mouse.handle.onmousemove;

      window.onmouseout = engine.mouse.handle.onmouseout;

      window.onmouseover = engine.mouse.handle.onmouseover;

      window.onmouseup = engine.mouse.handle.onmouseup;

      window.ontouchcancel = engine.mouse.handle.ontouchcancel;

      window.ontouchend = engine.mouse.handle.ontouchend;

      window.ontouchenter = engine.mouse.handle.ontouchenter;

      window.onteachleave = engine.mouse.handle.ontouchleave;

      window.ontouchmove = engine.mouse.handle.ontouchmove;

      window.ontouchstart = engine.mouse.handle.ontouchstart;

  }), repeatEvents:(function (){
"use strict";


      for(var button in engine.mouse.buttonBinds){

          for(var event in engine.mouse.buttonBinds[button]){

              if(engine.mouse.buttonBinds[button][event] !== void 0

                && engine.mouse.buttonId === button

                && engine.mouse.buttonBinds[button][event]['loop']){

                  engine.mouse.buttonBinds[button][event]();

              }

          }

      }

  }), set:{dimensions:(function (args){
"use strict";


        engine.mouse.click = {};

        engine.mouse.drag = {};

        engine.mouse.movement = {};

        engine.mouse.multiplier = {};

        engine.mouse.position = {};



        for(var dimension in args['dimensions']){

            engine.mouse.click[dimension] = 0;

            engine.mouse.drag[dimension] = 0;

            engine.mouse.movement[dimension] = 0;

            engine.mouse.multiplier[dimension] = 1;

            engine.mouse.position[dimension] = 0;

        }

    }), mouseButtonBind:(function (args){
"use strict";


        if(engine.mouse.buttonBinds[args['button']] === void 0){

            engine.mouse.buttonBinds[args['button']] = {};

        }



        engine.mouse.buttonBinds[args['button']][args['event']] = args['todo'];

        engine.mouse.buttonBinds[args['button']][args['event']]['cache'] = args['cache'];

        engine.mouse.buttonBinds[args['button']][args['event']]['loop'] = args['loop'];

    }), pointerLock:(function (args){
"use strict";


        engine.mouse.buttonId = -1;

        var todo = 'exitPointerLock';



        if(args['state']){

            todo = 'requestPointerLock';

        }



        document.getElementById(args['id'])[todo]();

    })}, buttonBinds:{0:{mousedown:(function (){
"use strict";


          engine.mouse.set.pointerLock({

            'id': 'canvas',

            'state': true,

          });

      })}, any:{mousemove:(function (){
"use strict";


          if(engine.mouse.pointerLock){

              engine.camera.rotate({

                'dimensions': {

                  'x': engine.mouse.movement['y'] / 10 * engine.mouse.multiplier['y'],

                  'y': engine.mouse.movement['x'] / 10 * engine.mouse.multiplier['x'],

                },

              });

          }

      })}}, buttonId:-1, click:{x:0, y:0}, drag:{x:0, y:0}, movement:{x:0, y:0}, multiplier:{x:1, y:1}, oncontextmenu:false, pointerLock:false, position:{x:0, y:0}, wheelDelta:0}, object:{clear:(function (args){
"use strict";


      var target = 'engine';

      for(var key in args['keys']){

          target += "['" + args['keys'][key] + "']";

      }

      target += ' = {};'



      eval(target);

  }), entity:{clone:(function (args){
"use strict";


        var properties = {};



        for(var property in engine.object.entities[args['entityKey']]){

            properties[property] = engine.object.entities[args['entityKey']][property];

        }



        engine.object.entity.set({

          'key': args['newKey'],

          'properties': properties,

        });

    }), copy:(function (args){
"use strict";


        for(var property in engine.object.entities[args['entityKey']]){

            engine.object.entities[args['targetKey']][property] =

              engine.object.entities[args['entityKey']][property];

        }

    }), delete:(function (args){
"use strict";


        delete engine.object.entities[args['key']];

    }), logic:(function (args){
"use strict";


        args = args || {};

        args['entity'] = args['entity'] || void 0;



        if(args['entity'] != void 0){

            if(engine.object.entities[args['entity']]['logic']){

                engine.object.entities[args['entity']]['logic']();

            }



        }else{

            for(var entity in engine.object.entities){

                if(engine.object.entities[entity]['logic']){

                    engine.object.entities[entity]['logic']();

                }

            }

        }

    }), set:(function (args){
"use strict";


        args['default'] = args['default'] || false;



        engine.object.entities[args['key']] = {};



        if(args['default'] !== false){

            for(var property in engine.object.defaults[args['default']]){

                if(engine.object.defaults[args['default']][property].constructor == Object){

                    if(!(property in engine.object.entities[args['key']])){

                        engine.object.entities[args['key']][property] = {};

                    }



                    for(var subproperty in engine.object.defaults[args['default']][property]){

                        engine.object.entities[args['key']][property][subproperty] =

                          engine.object.defaults[args['default']][property][subproperty];

                    }

                    continue;

                }



                engine.object.entities[args['key']][property] =

                  engine.object.defaults[args['default']][property];

            }

        }



        for(var property in args['properties']){

            if(args['properties'][property].constructor == Object){

                if(!(property in engine.object.entities[args['key']])){

                    engine.object.entities[args['key']][property] = {};

                }



                for(var subproperty in args['properties'][property]){

                    engine.object.entities[args['key']][property][subproperty] =

                      args['properties'][property][subproperty];

                }

                continue;

            }



            engine.object.entities[args['key']][property] = args['properties'][property];

        }

    })}, group:{add:(function (args){
"use strict";


        if(args['create'] === void 0){

            args['create'] = true;

        }



        if(!(args['group'] in engine.object.groups)){

            if(args['create']){

                engine.object.groups[args['group']] = {};

            }

        }



        for(var entity in args['entities']){

            engine.object.groups[args['group']][args['entities'][entity]] = 1;

        }

    }), modify:(function (args){
"use strict";


        for(var entity in engine.object.groups[args['group']]){

            args['todo'](entity);

        }

    }), remove:(function (args){
"use strict";


        if(args['remove'] === void 0){

            args['remove'] = true;

        }



        if(args['group'] in engine.object.groups){

            for(var entity in args['entities']){

                delete engine.object.groups[args['group']][args['entities'][entity]];

            }

        }



        if(engine.object.groups[args['group']].length <= 0

          && args['remove']){

            delete engine.object.groups[args['group']];

        }

    })}, sort:{custom:(function (args){
"use strict";


        args['array'].sort(args['todo']);

        args['descend'] = args['descend'] || false;



        if(args['descend']){

            args['array'].reverse();

        }

    }), numbers:(function (args){
"use strict";


        engine.object.sort.custom({

          'array': args['array'],

          'descend': args['descend'] || false,

          'todo': function(a, b){

              return a - b;

          },

        });

    }), property:(function (args){
"use strict";


        engine.object.sort.custom({

          'array': args['array'],

          'descend': args['descend'] || false,

          'todo': function(a, b){

              if(a[args['property']] > b[args['property']]){

                  return 1;



              }else if(a[args['property']] < b[args['property']]){

                  return -1;

              }



              return 0;

          },

        });

    }), random:(function (args){
"use strict";


        engine.object.sort.custom({

          'array': args['array'],

          'todo': function(a, b){

              return Math.random() - 0.5;

          },

        });

    }), strings:(function (args){
"use strict";


        engine.object.sort.custom({

          'array': args['array'],

          'descend': args['descend'] || false,

          'todo': function(a, b){

              return a.localeCompare(b);

          },

        });

    })}, defaults:{'Race-3D-rectangle':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:0, y:0, z:0}, rotate:{x:0, y:0, z:0}, scale:{x:1, y:1, z:1}, target:"buffer", vertices:[-1, 0, -1, 1, 0, -1, 1, 0, 1, -1, 0, 1]}}, entities:{'Race-3D-ground':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:0, y:-2, z:0}, rotate:{x:0, y:0, z:0}, scale:{x:25, y:1, z:25}, target:"buffer", vertices:[-1, 0, -1, 1, 0, -1, 1, 0, 1, -1, 0, 1], buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-wall-0':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:0, y:3, z:15}, rotate:{x:0, y:0, z:0}, scale:{x:1, y:1, z:1}, target:"buffer", vertices:[-15, -5, 0, 15, -5, 0, 15, -3, 0, -15, -3, 0], buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-wall-1':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:-15, y:3, z:0}, rotate:{x:0, y:0, z:0}, scale:{x:1, y:1, z:1}, target:"buffer", vertices:[0, -5, -15, 0, -5, 15, 0, -3, 15, 0, -3, -15], buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-wall-2':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:15, y:3, z:0}, rotate:{x:0, y:0, z:0}, scale:{x:1, y:1, z:1}, target:"buffer", vertices:[0, -5, 15, 0, -5, -15, 0, -3, -15, 0, -3, 15], buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-wall-3':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:0, y:3, z:0}, rotate:{x:0, y:0, z:0}, scale:{x:1, y:1, z:1}, target:"buffer", vertices:[0, -5, -5, 0, -5, -25, 0, -3, -25, 0, -3, -5], buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-racer':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:0, y:-1, z:20}, rotate:{x:0, y:90, z:0}, scale:{x:2, y:1, z:2}, target:"buffer", vertices:[-1, 0, -1, 1, 0, -1, 1, 0, 1, -1, 0, 1], angle:90, 'target-checkpoint':0, buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-checkpoint-0':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:22, y:0, z:20}, rotate:{x:0, y:0, z:0}, scale:{x:0, y:1, z:0}, target:"buffer", vertices:[-1, 0, -1, 1, 0, -1, 1, 0, 1, -1, 0, 1], next:1, buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-checkpoint-1':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:19, y:0, z:-20}, rotate:{x:0, y:0, z:0}, scale:{x:0, y:1, z:0}, target:"buffer", vertices:[-1, 0, -1, 1, 0, -1, 1, 0, 1, -1, 0, 1], next:2, buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-checkpoint-2':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:4, y:0, z:4}, rotate:{x:0, y:0, z:0}, scale:{x:0, y:1, z:0}, target:"buffer", vertices:[-1, 0, -1, 1, 0, -1, 1, 0, 1, -1, 0, 1], next:3, buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-checkpoint-3':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:-12, y:0, z:-20}, rotate:{x:0, y:0, z:0}, scale:{x:0, y:1, z:0}, target:"buffer", vertices:[-1, 0, -1, 1, 0, -1, 1, 0, 1, -1, 0, 1], next:4, buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}, 'Race-3D-checkpoint-4':{cull:false, index:[0, 1, 2, 0, 2, 3], mode:"TRIANGLE_FAN", position:{x:-20, y:0, z:20}, rotate:{x:0, y:0, z:0}, scale:{x:0, y:1, z:0}, target:"buffer", vertices:[-1, 0, -1, 1, 0, -1, 1, 0, 1, -1, 0, 1], next:0, buffer:{index:{}, texture:{}, vertex:{}}, texture:{}, image:{}}}, groups:{}}, time:{clear:{all:(function (){
"use strict";


        engine.time.clear.allAnimationFrames();

        engine.time.clear.allIntervals();

        engine.time.clear.allTimeouts();

    }), allAnimationFrames:(function (){
"use strict";


        for(var key in engine.time.animationFrames){

            engine.time.clear.animationFrame({

              'key': key,

            });

        }

    }), allIntervals:(function (){
"use strict";


        for(var key in engine.time.intervals){

            engine.time.clear.interval({

              'key': key,

            });

        }

    }), allTimeouts:(function (){
"use strict";


        for(var key in engine.time.timeouts){

            engine.time.clear.timeout({

              'key': key,

            });

        }

    }), animationFrame:(function (args){
"use strict";


        window.cancelAnimationFrame(engine.time.animationFrames[args['key']]);

        delete engine.time.animationFrames[args['key']];

    }), interval:(function (args){
"use strict";


        window.clearInterval(engine.time.intervals[args['key']]);

        delete engine.time.intervals[args['key']];

    }), timeout:(function (args){
"use strict";


        window.clearTimeout(engine.time.timeouts[args['key']]);

        delete engine.time.timeouts[args['key']];

    })}, date:{format:(function (args){
"use strict";


        args = args || {};

        args['date'] = new Date(args['date'] || Date.now());

        args['key'] = args['key'] || false;

        args['format'] = args['format'] || 'getTime';



        var result = args['date'][args['format']]();



        if(args['key'] !== false){

            engine.variables[args['key']] = result;

        }



        return Number(result);

    }), leapYear:(function (args){
"use strict";


        args = args || {};

        args['year'] = args['year'] !== void 0

          ? args['year']

          : new Date().getFullYear();



        return Boolean(

          (args['year'] % 4 === 0 && args['year'] % 100 !== 0)

          || args['year'] % 400 === 0

        );

    })}, requestAnimationFrame:(function (args){
"use strict";


      window.requestAnimationFrame(

        engine.time.animationFrames[args['key']]

      );

  }), set:{animationFrame:(function (args){
"use strict";


        engine.time.clear.animationFrame({

          'key': args['key'],

        });

        engine.time.animationFrames[args['key']] = args['todo'];

        window.requestAnimationFrame(args['todo']);

    }), interval:(function (args){
"use strict";


        engine.time.clear.interval({

          'key': args['key'],

        });

        engine.time.intervals[args['key']] = window.setInterval(

          args['todo'],

          args['interval']

        );

    }), timeout:(function (args){
"use strict";


        engine.time.clear.timeout({

          'key': args['key'],

        });

        engine.time.timeouts[args['key']] = window.setTimeout(

          args['todo'],

          args['timeout']

        );

    })}, animationFrames:{draw:(function (){
"use strict";


    engine.webgl.set.viewport({

      'target': 'buffer',

    });

    engine.webgl.clear({

      'target': 'buffer',

    });



    engine.variables['_camera'] = engine.math.matrix.create({

      'length': 16,

    });

    engine.math.matrix.identity({

      'matrix': engine.variables['_camera'],

    });



    engine.math.matrix.rotate({

      'dimensions': [

        engine.math.degreesToRadians({

          'degrees': engine.camera.rotation['x'],

        }),

        engine.math.degreesToRadians({

          'degrees': engine.camera.rotation['y'],

        }),

        engine.math.degreesToRadians({

          'degrees': engine.camera.rotation['z'],

        }),

      ],

      'matrix': engine.variables['_camera'],

    });

    engine.math.matrix.translate({

      'dimensions': [

        engine.camera.position['x'],

        engine.camera.position['y'],

        -engine.camera.position['z'],

      ],

      'matrix': engine.variables['_camera'],

    });



    engine.webgl.draw.entities();



    engine.canvas.clear();

    engine.canvas.draw.fromBuffer();



    engine.time.requestAnimationFrame({

      'key': 'draw',

    });

})}, intervals:{logic:2}, timeouts:{}}, webgl:{clear:(function (args){
"use strict";


      args = args || {};

      args['target'] = args['target'] || 'canvas';



      engine.canvas.canvases[args['target']].clear(

        engine.canvas.canvases[args['target']].COLOR_BUFFER_BIT

        | engine.canvas.canvases[args['target']].DEPTH_BUFFER_BIT

      );

  }), draw:{entities:(function (args){
"use strict";


        args = args || {};

        args['targetOverride'] = args['targetOverride'] || void 0;



        for(var entity in engine.object.entities){

            var cameraMatrixCache = engine.math.matrix.clone({

              'matrix': engine.variables['_camera'],

            });

            var target = args['targetOverride'] || engine.object.entities[entity]['target'] || 'canvas';



            if(engine.object.entities[entity]['cull'] === false){

                engine.webgl.set.property({

                  'property': 'CULL_FACE',

                  'state': false,

                  'target': target,

                });

            }



            engine.math.matrix.translate({

              'dimensions': [

                -engine.object.entities[entity]['position']['x'],

                -engine.object.entities[entity]['position']['y'],

                engine.object.entities[entity]['position']['z'],

              ],

              'matrix': engine.variables['_camera'],

            });



            engine.math.matrix.scale({

              'dimensions': [

                engine.object.entities[entity]['scale']['x'],

                engine.object.entities[entity]['scale']['y'],

                -engine.object.entities[entity]['scale']['z'],

              ],

              'matrix': engine.variables['_camera'],

            });



            engine.math.matrix.rotate({

              'dimensions': [

                engine.math.degreesToRadians({

                  'degrees': engine.object.entities[entity]['rotate']['x'],

                }),

                engine.math.degreesToRadians({

                  'degrees': engine.object.entities[entity]['rotate']['y'],

                }),

                engine.math.degreesToRadians({

                  'degrees': engine.object.entities[entity]['rotate']['z'],

                }),

              ],

              'matrix': engine.variables['_camera'],

            });



            /*

            engine.canvas.canvases[target].bindBuffer(

              engine.canvas.canvases[target].ARRAY_BUFFER,

              engine.object.entities[entity]['buffer']['color']

            );

            engine.canvas.canvases[target].vertexAttribPointer(

              engine.webgl.attributes['vec_vertexColor'],

              4,

              engine.canvas.canvases[target].FLOAT,

              false,

              0,

              0,

              target

            );

            */



            engine.canvas.canvases[target].bindBuffer(

              engine.canvas.canvases[target].ARRAY_BUFFER,

              engine.object.entities[entity]['buffer']['vertex']

            );

            engine.canvas.canvases[target].vertexAttribPointer(

              engine.webgl.attributes['vec_vertexPosition'],

              3,

              engine.canvas.canvases[target].FLOAT,

              false,

              0,

              0,

              target

            );



            engine.canvas.canvases[target].bindBuffer(

              engine.canvas.canvases[target].ARRAY_BUFFER,

              engine.object.entities[entity]['buffer']['texture']

            );

            engine.canvas.canvases[target].vertexAttribPointer(

              engine.webgl.attributes['vec_texturePosition'],

              2,

              engine.canvas.canvases[target].FLOAT,

              false,

              0,

              0,

              target

            );



            engine.canvas.canvases[target].activeTexture(engine.canvas.canvases[target].TEXTURE0);

            engine.canvas.canvases[target].bindTexture(

              engine.canvas.canvases[target].TEXTURE_2D,

              engine.object.entities[entity]['texture']

            );

            engine.canvas.canvases[target].uniform1i(

              engine.canvas.canvases[target].getUniformLocation(

                engine.webgl.programs['shaders'],

                'sampler'

              ),

              0

            );



            engine.canvas.canvases[target].bindBuffer(

              engine.canvas.canvases[target].ARRAY_BUFFER,

              engine.object.entities[entity]['buffer']['index']

            );



            engine.canvas.canvases[target].uniformMatrix4fv(

              engine.canvas.canvases[target].getUniformLocation(

                engine.webgl.programs['shaders'],

                'mat_perspectiveMatrix'

              ),

              0,

              engine.variables['_perspective']['value']

            );



            engine.canvas.canvases[target].uniformMatrix4fv(

              engine.canvas.canvases[target].getUniformLocation(

                engine.webgl.programs['shaders'],

                'mat_cameraMatrix'

              ),

              0,

              engine.variables['_camera']['value']

            );



            engine.canvas.canvases[target].drawArrays(

              engine.canvas.canvases[target][engine.webgl.mode || engine.object.entities[entity]['mode']],

              0,

              Math.floor(engine.object.entities[entity]['vertices'].length / 3)

            );



            if(engine.object.entities[entity]['cull'] === false){

                engine.webgl.set.property({

                  'property': 'CULL_FACE',

                  'target': target,

                });

            }



            engine.math.matrix.copy({

              'from': cameraMatrixCache,

              'matrix': engine.variables['_camera'],

            });

        }

    })}, init:(function (args){
"use strict";


      args = args || {};

      args['buffer'] = args['buffer'] || 'buffer';

      args['canvas'] = args['canvas'] || 'canvas';

      args['options'] = args['options'] || {

        'alpha': false,

        'antialias': true,

        'depth': true,

        'preserveDrawingBuffer': false,

        'premultipliedAlpha': false,

        'stencil': false,

      };

      args['target'] = args['target'] || 'canvas';



      engine.canvas.canvases['buffer'] =

        document.getElementById(args['buffer']).getContext('webgl', args['options']);

      engine.canvas.canvases['canvas'] =

        document.getElementById(args['canvas']).getContext('2d', args['options']);



      engine.webgl.resize({

        'target': args['target'],

      });

      eval(

        'window.onresize = function(event){'

        +   'engine.webgl.resize({'

        +     '\'target\': \'' + args['target'] + '\','

        +   '});'

        + '}'

      );



      engine.variables['_perspective'] = engine.math.matrix.camera({

        'height': engine.canvas.height,

        'width': engine.canvas.width,

      });



      engine.webgl.set.clearColor({

        'alpha': 1,

        'blue': 0,

        'green': 0,

        'red': 0,

        'target': args['target'],

      });



      engine.canvas.canvases[args['target']].clearDepth(1);

      engine.webgl.set.property({

        'property': 'CULL_FACE',

        'target': args['target'],

      });

      engine.webgl.set.property({

        'property': 'DEPTH_TEST',

        'target': args['target'],

      });

      engine.canvas.canvases[args['target']].depthFunc(

        engine.canvas.canvases[args['target']].LEQUAL

      );



      engine.webgl.set.fragmentShader({

        'target': args['target'],

      });

      engine.webgl.set.vertexShader({

        'target': args['target'],

      });



      engine.webgl.set.program({

        'key': 'shaders',

        'shaders': [

          engine.webgl.shaders['fragment'],

          engine.webgl.shaders['vertex'],

        ],

        'target': args['target'],

        'use': true,

      });



      /*

      engine.webgl.set.vertexAttribArray({

        'attribute': 'vec_vertexColor',

        'program': engine.webgl.programs['shaders'],

        'target': args['target'],

      });

      */



      engine.webgl.set.vertexAttribArray({

        'attribute': 'vec_vertexPosition',

        'program': engine.webgl.programs['shaders'],

        'target': args['target'],

      });



      engine.webgl.set.vertexAttribArray({

        'attribute': 'vec_texturePosition',

        'program': engine.webgl.programs['shaders'],

        'target': args['target'],

      });

  }), pick:(function (args){
"use strict";


      args['target'] = args['target'] || 'canvas';



      // Picking code here.

  }), resize:(function (args){
"use strict";


      args = args || {};

      args['target'] = args['target'] || 'canvas';



      engine.canvas.resize();



      engine.canvas.canvases[args['target']].viewportHeight = engine.canvas.height;

      engine.canvas.canvases[args['target']].viewportWidth = engine.canvas.width;



      engine.webgl.set.viewport({

        'target': args['target'],

      });

  }), set:{buffer:(function (args){
"use strict";


        args['target'] = args['target'] || 'canvas';



        /*

        var colorBuffer = engine.canvas.canvases[args['target']].createBuffer();

        engine.canvas.canvases[args['target']].bindBuffer(

          args['bufferType'],

          colorBuffer

        );

        engine.canvas.canvases[args['target']].bufferData(

          args['bufferType'],

          new Float32Array(args['colorData']),

          engine.canvas.canvases[args['target']].STATIC_DRAW

        );

        */



        var vertexBuffer = engine.canvas.canvases[args['target']].createBuffer();

        engine.canvas.canvases[args['target']].bindBuffer(

          args['bufferType'],

          vertexBuffer

        );

        engine.canvas.canvases[args['target']].bufferData(

          args['bufferType'],

          new Float32Array(args['vertexData']),

          engine.canvas.canvases[args['target']].STATIC_DRAW

        );



        var textureBuffer = engine.canvas.canvases[args['target']].createBuffer();

        engine.canvas.canvases[args['target']].bindBuffer(

          args['bufferType'],

          textureBuffer

        );

        engine.canvas.canvases[args['target']].bufferData(

          args['bufferType'],

          new Float32Array(args['textureData']),

          engine.canvas.canvases[args['target']].STATIC_DRAW

        );



        var indexBuffer = engine.canvas.canvases[args['target']].createBuffer();

        engine.canvas.canvases[args['target']].bindBuffer(

          args['bufferType'],

          indexBuffer

        );

        engine.canvas.canvases[args['target']].bufferData(

          args['bufferType'],

          new Uint16Array(args['indexData']),

          engine.canvas.canvases[args['target']].STATIC_DRAW

        );



        return {

          //'color': colorBuffer,

          'index': indexBuffer,

          'texture': textureBuffer,

          'vertex': vertexBuffer,

        }

    }), clearColor:(function (args){
"use strict";


        args['target'] = args['target'] || 'canvas';



        engine.webgl.clearColor[args['target']] = [

          args['red'],

          args['green'],

          args['blue'],

          args['alpha'],

        ];

        engine.canvas.canvases[args['target']].clearColor(

          args['red'],

          args['green'],

          args['blue'],

          args['alpha']

        );

    }), fragmentShader:(function (args){
"use strict";


        args = args || {};

        args['target'] = args['target'] || 'canvas';



        var source =

            'precision mediump float;'

        //+ 'varying float float_fogDistance;'

        //+ 'varying vec4 vec_fragmentColor;'

          + 'varying vec2 vec_textureCoord;'

          + 'uniform sampler2D sampler;'

          + 'void main(void){'

        /*

          +   'gl_FragColor = mix('

          +     'vec4('

          +       engine.webgl.clearColor[args['target']][0].toFixed(1) + ','

          +       engine.webgl.clearColor[args['target']][1].toFixed(1) + ','

          +       engine.webgl.clearColor[args['target']][2].toFixed(1) + ','

          +       engine.webgl.clearColor[args['target']][3].toFixed(1)

          +     '),'

          +     'vec_fragmentColor,'

          +     'clamp(exp(-0.001 * float_fogDistance * float_fogDistance), 0.0, 1.0)'

          +   ');'

        */

          +   'gl_FragColor = texture2D('

          +     'sampler,'

          +     'vec_textureCoord.st'

          +   ');'

          + '}';

        engine.webgl.set.shader({

          'key': 'fragment',

          'source': source,

          'target': args['target'],

          'type': engine.canvas.canvases[args['target']].FRAGMENT_SHADER,

        });

    }), program:(function (args){
"use strict";


        args['target'] = args['target'] || 'canvas';

        args['use'] = args['use'] || false;



        var program = engine.canvas.canvases[args['target']].createProgram();



        for(var shader in args['shaders']){

            engine.canvas.canvases[args['target']].attachShader(

              program,

              args['shaders'][shader]

            );

        }



        engine.canvas.canvases[args['target']].linkProgram(program);



        if(args['use']){

            engine.canvas.canvases[args['target']].useProgram(program);

        }



        engine.webgl.programs[args['key']] = program;

    }), property:(function (args){
"use strict";


        args['state'] = args['state'] === false

          ? 'disable'

          : 'enable';

        args['target'] = args['target'] || 'canvas';



        engine.canvas.canvases[args['target']][args['state']](

          engine.canvas.canvases[args['target']][args['property']]

        );

    }), shader:(function (args){
"use strict";


        args['target'] = args['target'] || 'canvas';



        var shader = engine.canvas.canvases[args['target']].createShader(args['type']);

        engine.canvas.canvases[args['target']].shaderSource(

          shader,

          args['source']

        );

        engine.canvas.canvases[args['target']].compileShader(shader);



        engine.webgl.shaders[args['key']] = shader;

    }), texture2D:(function (args){
"use strict";


        args['image'] = args['image'] || engine.variables['_fff.png'];

        args['target'] = args['target'] || 'canvas';



        engine.object.entities[args['entity']]['texture'] = engine.canvas.canvases[args['target']].createTexture();



        engine.object.entities[args['entity']]['image'] = new Image();

        engine.object.entities[args['entity']]['image'].onload = function(){

            engine.canvas.canvases[args['target']].bindTexture(

              engine.canvas.canvases[args['target']].TEXTURE_2D,

              engine.object.entities[args['entity']]['texture']

            );

            engine.canvas.canvases[args['target']].texImage2D(

              engine.canvas.canvases[args['target']].TEXTURE_2D,

              0,

              engine.canvas.canvases[args['target']].RGBA,

              engine.canvas.canvases[args['target']].RGBA,

              engine.canvas.canvases[args['target']].UNSIGNED_BYTE,

              engine.object.entities[args['entity']]['image']

            );

            engine.canvas.canvases[args['target']].texParameteri(

              engine.canvas.canvases[args['target']].TEXTURE_2D,

              engine.canvas.canvases[args['target']].TEXTURE_MAG_FILTER,

              engine.canvas.canvases[args['target']].NEAREST

            );

            engine.canvas.canvases[args['target']].texParameteri(

              engine.canvas.canvases[args['target']].TEXTURE_2D,

              engine.canvas.canvases[args['target']].TEXTURE_MIN_FILTER,

              engine.canvas.canvases[args['target']].NEAREST

            );

            /*

            engine.canvas.canvases[args['target']].generateMipmap(

              engine.canvas.canvases[args['target']].TEXTURE_2D

            );

            */



            engine.canvas.canvases[args['target']].bindTexture(

              engine.canvas.canvases[args['target']].TEXTURE_2D,

              void 0

            );

        }

        engine.object.entities[args['entity']]['image'].src = args['image'];

    }), vertexAttribArray:(function (args){
"use strict";


        args['target'] = args['target'] || 'canvas';



        engine.webgl.attributes[args['attribute']] = engine.canvas.canvases[args['target']].getAttribLocation(

          args['program'],

          args['attribute']

        );

        engine.canvas.canvases[args['target']].enableVertexAttribArray(engine.webgl.attributes[args['attribute']]);

    }), vertexShader:(function (args){
"use strict";


        args = args || {};

        args['target'] = args['target'] || 'canvas';



        var source =

            'attribute vec3 vec_vertexPosition;'

        //+ 'attribute vec4 vec_vertexColor;'

          + 'attribute vec2 vec_texturePosition;'

          + 'uniform mat4 mat_cameraMatrix;'

          + 'uniform mat4 mat_perspectiveMatrix;'

        //+ 'varying float float_fogDistance;'

        //+ 'varying vec4 vec_fragmentColor;'

          + 'varying vec2 vec_textureCoord;'

          + 'void main(void){'

          +   'gl_Position = mat_perspectiveMatrix * mat_cameraMatrix * vec4(vec_vertexPosition, 1.0);'

        //+   'vec_fragmentColor = vec_vertexColor;'

        //+   'float_fogDistance = length(gl_Position.xyz);'

          +   'vec_textureCoord = vec_texturePosition;'

          + '}';

        engine.webgl.set.shader({

          'key': 'vertex',

          'source': source,

          'target': args['target'],

          'type': engine.canvas.canvases[args['target']].VERTEX_SHADER,

        });

    }), viewport:(function (args){
"use strict";


        args = args || {};

        args['target'] = args['target'] || 'canvas';



        engine.canvas.canvases[args['target']].viewport(

          0,

          0,

          engine.canvas.canvases[args['target']].viewportWidth,

          engine.canvas.canvases[args['target']].viewportHeight

        );

    })}, attributes:{vec_vertexPosition:0, vec_texturePosition:1}, clearColor:{buffer:[0, 0, 0, 1]}, mode:false, programs:{shaders:{}}, shaders:{fragment:{}, vertex:{}}}, draw:(function (){
"use strict";


    engine.webgl.set.viewport({

      'target': 'buffer',

    });

    engine.webgl.clear({

      'target': 'buffer',

    });



    engine.variables['_camera'] = engine.math.matrix.create({

      'length': 16,

    });

    engine.math.matrix.identity({

      'matrix': engine.variables['_camera'],

    });



    engine.math.matrix.rotate({

      'dimensions': [

        engine.math.degreesToRadians({

          'degrees': engine.camera.rotation['x'],

        }),

        engine.math.degreesToRadians({

          'degrees': engine.camera.rotation['y'],

        }),

        engine.math.degreesToRadians({

          'degrees': engine.camera.rotation['z'],

        }),

      ],

      'matrix': engine.variables['_camera'],

    });

    engine.math.matrix.translate({

      'dimensions': [

        engine.camera.position['x'],

        engine.camera.position['y'],

        -engine.camera.position['z'],

      ],

      'matrix': engine.variables['_camera'],

    });



    engine.webgl.draw.entities();



    engine.canvas.clear();

    engine.canvas.draw.fromBuffer();



    engine.time.requestAnimationFrame({

      'key': 'draw',

    });

}), init:(function (){
"use strict";


    engine.project.set.title({

      'title': 'Race-3D.htm',

    });



    engine.camera.set.dimensions({

      'dimensions': {

        'x': 0,

        'y': 0,

        'z': 0,

      },

    });

    engine.keyboard.init();

    engine.mouse.init();

    engine.mouse.set.dimensions({

      'dimensions': {

        'x': 0,

        'y': 0,

      },

    });

    engine.mouse.oncontextmenu = false;



    engine.html.set.element({

      'classes': [

        'hidden',

      ],

      'id': 'buffer',

      'type': 'canvas',

    });

    engine.html.set.element({

      'id': 'canvas',

      'type': 'canvas',

    });



    engine.webgl.init({

      'target': 'buffer',

    });



    engine.keyboard.set.keyBind({

      'event': 'keydown',

      'key': 'A',

      'loop': true,

      'todo': function(){

          engine.camera.move({

            'dy': 0,

            'speed': -.1,

            'strafe': true,

          });

      },

    });

    engine.keyboard.set.keyBind({

      'event': 'keydown',

      'key': 'C',

      'loop': true,

      'todo': function(){

          engine.camera.move({

            'dy': -.1,

            'speed': 0,

          });

      },

    });

    engine.keyboard.set.keyBind({

      'event': 'keydown',

      'key': 'D',

      'loop': true,

      'todo': function(){

          engine.camera.move({

            'dy': 0,

            'speed': .1,

            'strafe': true,

          });

      },

    });

    engine.keyboard.set.keyBind({

      'event': 'keydown',

      'key': 'S',

      'loop': true,

      'todo': function(){

          engine.camera.move({

            'dy': 0,

            'speed': -.1,

          });

      },

    });

    engine.keyboard.set.keyBind({

      'event': 'keydown',

      'key': 32,/* Space */

      'loop': true,

      'todo': function(){

          engine.camera.move({

            'dy': .1,

            'speed': 0,

          });

      },

    });

    engine.keyboard.set.keyBind({

      'event': 'keydown',

      'key': 'W',

      'loop': true,

      'todo': function(){

          engine.camera.move({

            'dy': 0,

            'speed': .1,

          });

      },

    });



    engine.mouse.set.mouseButtonBind({

      'button': 0,

      'event': 'mousedown',

      'todo': function(){

          engine.mouse.set.pointerLock({

            'id': 'canvas',

            'state': true,

          });

      },

    });

    engine.mouse.set.mouseButtonBind({

      'button': 'any',

      'event': 'mousemove',

      'todo': function(){

          if(engine.mouse.pointerLock){

              engine.camera.rotate({

                'dimensions': {

                  'x': engine.mouse.movement['y'] / 10 * engine.mouse.multiplier['y'],

                  'y': engine.mouse.movement['x'] / 10 * engine.mouse.multiplier['x'],

                },

              });

          }

      },

    });



    // Create default rectangle entity.

    engine.object.defaults['Race-3D-rectangle'] = {

      /*

      'color': [

        1.0, 0.0, 0.0, 1.0,

        0.0, 1.0, 0.0, 1.0,

        0.0, 0.0, 1.0, 1.0,

        1.0, 1.0, 1.0, 1.0,

      ],

      */

      'cull': false,

      'index': [

        0, 1, 2, 0, 2, 3,

      ],

      'mode': 'TRIANGLE_FAN',

      'position': {

        'x': 0,

        'y': 0,

        'z': 0,

      },

      'rotate': {

        'x': 0,

        'y': 0,

        'z': 0,

      },

      'scale': {

        'x': 1,

        'y': 1,

        'z': 1,

      },

      'target': 'buffer',

      'vertices': [

        -1, 0, -1,

        1, 0, -1,

        1, 0, 1,

        -1, 0, 1,

      ],

    };



    // Ground.

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-ground',

      'properties': {

        'position': {

          'y': -2,

        },

        'scale': {

          'x': 25,

          'z': 25,

        },

      },

    });



    // Walls.

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-wall-0',

      'properties': {

        'position': {

          'y': 3,

          'z': 15,

        },

        'vertices': [

          -15, -5, 0,

          15, -5, 0,

          15, -3, 0,

          -15, -3, 0,

        ],

      },

    });

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-wall-1',

      'properties': {

        'position': {

          'x': -15,

          'y': 3,

        },

        'vertices': [

          0, -5, -15,

          0, -5, 15,

          0, -3, 15,

          0, -3, -15,

        ],

      },

    });

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-wall-2',

      'properties': {

        'position': {

          'x': 15,

          'y': 3,

        },

        'vertices': [

          0, -5, 15,

          0, -5, -15,

          0, -3, -15,

          0, -3, 15,

        ],

      },

    });

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-wall-3',

      'properties': {

        'position': {

          'y': 3,

        },

        'vertices': [

          0, -5, -5,

          0, -5, -25,

          0, -3, -25,

          0, -3, -5,

        ],

      },

    });



    // Racer.

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-racer',

      'properties': {

        'angle': 0,

        'position': {

          'y': -1,

          'z': 20,

        },

        'scale': {

          'x': 2,

          'z': 2,

        },

        'rotate': {

          'y': 0,

        },

        'target-checkpoint': 0,

      },

    });



    // Checkpoints.

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-checkpoint-0',

      'properties': {

        'next': 1,

        'position': {

          'x': 22,

          'z': 20,

        },

        'scale': {

          'x': 0,

          'z': 0,

        },

      },

    });

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-checkpoint-1',

      'properties': {

        'next': 2,

        'position': {

          'x': 19,

          'z': -20,

        },

        'scale': {

          'x': 0,

          'z': 0,

        },

      },

    });

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-checkpoint-2',

      'properties': {

        'next': 3,

        'position': {

          'x': 4,

          'z': 4,

        },

        'scale': {

          'x': 0,

          'z': 0,

        },

      },

    });

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-checkpoint-3',

      'properties': {

        'next': 4,

        'position': {

          'x': -12,

          'z': -20,

        },

        'scale': {

          'x': 0,

          'z': 0,

        },

      },

    });

    engine.object.entity.set({

      'default': 'Race-3D-rectangle',

      'key': 'Race-3D-checkpoint-4',

      'properties': {

        'next': 0,

        'position': {

          'x': -20,

          'z': 20,

        },

        'scale': {

          'x': 0,

          'z': 0,

        },

      },

    });



    for(var entity in engine.object.entities){

        engine.object.entities[entity]['buffer'] = engine.webgl.set.buffer({

          'bufferType': engine.canvas.canvases['buffer'].ARRAY_BUFFER,

          //'colorData': engine.object.entities[entity]['color'],

          'indexData': engine.object.entities[entity]['index'],

          'target': engine.object.entities[entity]['target'],

          'textureData': [

            0.0, 1.0,

            0.0, 0.0,

            1.0, 0.0,

            1.0, 1.0,

          ],

          'vertexData': engine.object.entities[entity]['vertices'],

        });

        engine.webgl.set.texture2D({

          'entity': entity,

          'image': engine.variables['_default.png'],

          'target': 'buffer',

        });

    }



    engine.time.set.animationFrame({

      'key': 'draw',

      'todo': engine.draw,

    });

    engine.time.set.interval({

      'interval': 50,

      'key': 'logic',

      'todo': 'engine.logic()',

    });



    engine.project.compile();

}), logic:(function (){
"use strict";


    engine.keyboard.repeatEvents();

    engine.mouse.repeatEvents();



    engine.object.entity.logic();



    if(engine.math.distance({

      'point0': {

        'x': engine.object.entities['Race-3D-racer']['position']['x'],

        'z': engine.object.entities['Race-3D-racer']['position']['z'],

      },

      'point1': {

        'x': engine.object.entities['Race-3D-checkpoint-' + engine.object.entities['Race-3D-racer']['target-checkpoint']]['position']['x'],

        'z': engine.object.entities['Race-3D-checkpoint-' + engine.object.entities['Race-3D-racer']['target-checkpoint']]['position']['z'],

      },

    }) < .5){

        engine.object.entities['Race-3D-racer']['target-checkpoint'] =

          engine.object.entities['Race-3D-checkpoint-' + engine.object.entities['Race-3D-racer']['target-checkpoint']]['next'];

    }



    var angle = Math.atan2(

      engine.object.entities['Race-3D-checkpoint-' + engine.object.entities['Race-3D-racer']['target-checkpoint']]['position']['z']

        - engine.object.entities['Race-3D-racer']['position']['z'],

      engine.object.entities['Race-3D-checkpoint-' + engine.object.entities['Race-3D-racer']['target-checkpoint']]['position']['x']

        - engine.object.entities['Race-3D-racer']['position']['x']

    );

    if(angle < 0){

        angle += Math.PI * 2;



    }else if(angle > Math.PI * 2){

        angle -= Math.PI * 2;

    }



    if(engine.object.entities['Race-3D-racer']['angle'] > angle){

      engine.object.entities['Race-3D-racer']['angle'] -= .1;



    }else if(engine.object.entities['Race-3D-racer']['angle'] < angle){

      engine.object.entities['Race-3D-racer']['angle'] += .1;

    }



    engine.object.entities['Race-3D-racer']['rotate']['y'] = engine.math.radiansToDegrees({

      'radians': -engine.object.entities['Race-3D-racer']['angle'],

    });



    engine.object.entities['Race-3D-racer']['position']['x'] +=

      Math.cos(engine.object.entities['Race-3D-racer']['angle']) / 2;

    engine.object.entities['Race-3D-racer']['position']['z'] +=

      Math.sin(engine.object.entities['Race-3D-racer']['angle']) / 2;

})};window.onload=engine.init;</script>"
